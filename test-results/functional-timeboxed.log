
> rest-express@1.0.0 run:func:timeout
> node scripts/run-with-timeout.mjs 600 'npm run test:functional'


> rest-express@1.0.0 test:functional
> npm run build && tsx scripts/functional-tests.ts


> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.19 building for production...
transforming...
âœ“ 3354 modules transformed.
rendering chunks...
computing gzip size...
../dist/public/index.html                       2.42 kB â”‚ gzip:   0.92 kB
../dist/public/assets/index-B52fWKlG.css       70.33 kB â”‚ gzip:  12.42 kB
../dist/public/assets/input-DTh9FO78.js         0.62 kB â”‚ gzip:   0.37 kB
../dist/public/assets/not-found-DHsg-N0R.js     0.72 kB â”‚ gzip:   0.41 kB
../dist/public/assets/card-CCpIX1gV.js          1.03 kB â”‚ gzip:   0.39 kB
../dist/public/assets/select-DbUZ0Jw7.js        3.11 kB â”‚ gzip:   1.14 kB
../dist/public/assets/chart-DLmIzyqq.js         4.59 kB â”‚ gzip:   1.94 kB
../dist/public/assets/home-RDarpIEi.js          5.97 kB â”‚ gzip:   2.06 kB
../dist/public/assets/scheduling-CmD-jkTR.js    8.69 kB â”‚ gzip:   2.41 kB
../dist/public/assets/marketing-s5EdLQ0x.js     8.94 kB â”‚ gzip:   2.78 kB
../dist/public/assets/staff-DBDinTXc.js         9.13 kB â”‚ gzip:   2.24 kB
../dist/public/assets/inventory-BdwTlebz.js     9.29 kB â”‚ gzip:   2.52 kB
../dist/public/assets/loyalty-D2cSzbZT.js       9.59 kB â”‚ gzip:   2.87 kB
../dist/public/assets/pos-mZNjMqXd.js          14.40 kB â”‚ gzip:   4.04 kB
../dist/public/assets/icons-CUuMniuQ.js        15.81 kB â”‚ gzip:   3.25 kB
../dist/public/assets/analytics-BVIYQDfh.js    17.74 kB â”‚ gzip:   4.14 kB
../dist/public/assets/index-C0RAkEYh.js        32.81 kB â”‚ gzip:   9.63 kB
../dist/public/assets/query-CyeIJ-bU.js        36.17 kB â”‚ gzip:  10.92 kB
../dist/public/assets/charts-f_bXvggi.js      241.78 kB â”‚ gzip:  56.48 kB
../dist/public/assets/vendor-DvMHagaH.js      458.15 kB â”‚ gzip: 151.33 kB
âœ“ built in 58.96s
ğŸš€ Starting Functional Test Suite
=================================
ğŸ“¡ Starting test server...
âœ… Test server running on port 62257
ğŸ¯ Running all functional tests...

ğŸš€ Starting Comprehensive Functional Test Suite
================================================

ğŸ“¡ Phase 1: API Endpoint Testing
--------------------------------

=== API Endpoint Testing Suite ===

--- Basic Endpoint Tests ---
Running API test: Health Check
âœ… Health Check (5ms)
Running API test: Get Business Profile
âœ… Get Business Profile (6ms)
Running API test: Get All Services
âœ… Get All Services (4ms)
Running API test: Get All Staff
âœ… Get All Staff (3ms)
Running API test: Get All Customers
âœ… Get All Customers (4ms)
Running API test: Get All Appointments
âœ… Get All Appointments (32ms)
Running API test: Get Today Appointments
âœ… Get Today Appointments (20ms)
Running API test: Get Appointments by Date
âœ… Get Appointments by Date (3ms)
Running API test: Get All Inventory
âœ… Get All Inventory (3ms)
Running API test: Get All Analytics
âœ… Get All Analytics (5ms)
Running API test: Get All Sales
âœ… Get All Sales (3ms)
Running API test: Create POS Sale
Running API test: Get All Campaigns
âœ… Get All Campaigns (3ms)
Running API test: Create Marketing Campaign
Running API test: Get Marketing Performance
âœ… Get Marketing Performance (3ms)
Running API test: Get All Loyalty Entries
âœ… Get All Loyalty Entries (2ms)
Running API test: Analytics CSV Export
âœ… Analytics CSV Export (2ms)
Running API test: POS Sales CSV Export
âœ… POS Sales CSV Export (2ms)
Running API test: Loyalty Entries CSV Export
âœ… Loyalty Entries CSV Export (2ms)
Running API test: Chat Non-Streaming
âœ… Chat Non-Streaming (2ms)
Running API test: Demo Seed
âœ… Demo Seed (2ms)
Running API test: Demo Time Freeze
âœ… Demo Time Freeze (1ms)
Running API test: Demo Reset
âœ… Demo Reset (1ms)

--- Individual Resource Tests ---
Running API test: Get Individual Service
â­ï¸  Get Individual Service (skipped)
Running API test: Get Individual Staff Member
â­ï¸  Get Individual Staff Member (skipped)
Running API test: Get Individual Appointment
â­ï¸  Get Individual Appointment (skipped)
Running API test: Get Individual Inventory Item
â­ï¸  Get Individual Inventory Item (skipped)
Running API test: Get Individual Analytics
â­ï¸  Get Individual Analytics (skipped)

--- Error Scenario Tests ---
Running error scenario: Service Not Found
âœ… Service Not Found (1ms)
Running error scenario: Staff Not Found
âœ… Staff Not Found (1ms)
Running error scenario: Appointment Not Found
âœ… Appointment Not Found (1ms)
Running error scenario: Inventory Item Not Found
âœ… Inventory Item Not Found (1ms)
Running error scenario: Analytics Not Found
âœ… Analytics Not Found (1ms)
Running error scenario: Campaign Not Found
âœ… Campaign Not Found (4ms)
Running error scenario: Sale Not Found
âœ… Sale Not Found (7ms)
Running error scenario: Invalid Date Format
âœ… Invalid Date Format (5ms)
Running error scenario: Missing Required Fields - Campaign
âœ… Missing Required Fields - Campaign (2ms)
Running error scenario: Missing Required Fields - Sale
âœ… Missing Required Fields - Sale (2ms)
Running error scenario: Empty Items Array - Sale
âœ… Empty Items Array - Sale (2ms)
Running error scenario: Missing Required Fields - Loyalty Entry
âœ… Missing Required Fields - Loyalty Entry (3ms)
Running error scenario: Invalid JSON - Campaign
âœ… Invalid JSON - Campaign (7ms)
Running error scenario: XSS Attempt in Campaign Name
Running error scenario: SQL Injection Attempt in Date Filter
âœ… SQL Injection Attempt in Date Filter (1ms)
Running error scenario: Oversized Payload - Campaign
Running error scenario: Nonexistent Endpoint

--- CSV Export Validation ---
âœ… Analytics CSV: Valid CSV export
âœ… POS Sales CSV: Valid CSV export
âœ… Loyalty CSV: Valid CSV export

--- Streaming Functionality ---
Testing streaming chat...
âœ… Streaming chat: Received 436 characters

=== API Test Suite Summary ===
Total Tests: undefined
âœ… Passed: 21
âŒ Failed: 0
â­ï¸  Skipped: 0
â±ï¸  Average Response Time: 5.14ms

âœ… API Test Suite PASSED

--- CRUD Operations Tests ---
âœ… Marketing Campaign CRUD: Create and update operations successful
âœ… Loyalty Entry CRUD: Create and filter operations successful

ğŸ§® Phase 2: Business Logic Validation
------------------------------------

=== Business Logic Validation Tests ===

--- POS Transaction Calculation Tests ---
âœ… Basic Service Sale Calculation (4ms)
âœ… Multiple Items Calculation (2ms)
âœ… Discount Calculation (2ms)
âœ… Tax Calculation (4ms)
âœ… Combined Discount and Tax Calculation (4ms)

--- Inventory Management Tests ---
âœ… Inventory Status Calculation (1ms)
âœ… Low Inventory Scenario Validation (8ms)
âœ… Product Sale Inventory Deduction (68ms)

--- Scheduling and Staff Assignment Tests ---
âœ… Appointment Time Validation (24ms)
âœ… Staff Assignment Validation (9ms)
âœ… Service Assignment Validation (8ms)
âœ… Appointment Gaps Scenario Validation (34ms)

--- Loyalty Program Tests ---
âœ… Loyalty Entry Creation (5ms)
âœ… Customer Loyalty Filtering (20ms)
âœ… Loyalty Entry Types Validation (33ms)

--- Marketing Campaign Tests ---
âœ… Campaign Creation and Status Management (6ms)
âœ… Marketing Performance Calculation (4ms)
âœ… Campaign Performance Determinism (7ms)

=== Business Logic Test Summary ===
Total Tests: 20
âœ… Passed: 18
âŒ Failed: 2
â±ï¸  Average Duration: 13.35ms

âŒ Failed Tests:
   â€¢ Busy Day Scenario Validation: Scheduling conflict detected for staff 797081cf-c993-4df8-b155-03319682091b: Sun Sep 14 2025 11:30:00 GMT-0600 (Mountain Daylight Time) - Sun Sep 14 2025 12:45:00 GMT-0600 (Mountain Daylight Time) overlaps with Sun Sep 14 2025 10:30:00 GMT-0600 (Mountain Daylight Time) - Sun Sep 14 2025 11:45:00 GMT-0600 (Mountain Daylight Time)
   â€¢ Invalid Loyalty Entry Validation: Validation failures: Unexpected error: Error: POST /api/loyalty/entries -> 400; Unexpected error: Error: POST /api/loyalty/entries -> 400; Unexpected error: Error: POST /api/loyalty/entries -> 400

âŒ Business Logic Tests FAILED

ğŸ–¥ï¸  Phase 3: UI Component Integration
-----------------------------------

=== UI Component Integration Tests ===
âœ… Page Loading and Initial Render (24ms)
âœ… Sidebar Navigation (794ms)
âœ… Chat Interface Functionality (747ms)
âœ… POS Interface Functionality (1242ms)
âœ… Analytics Interface Functionality (694ms)
âœ… Form Validation (709ms)
âœ… Keyboard Shortcuts (875ms)
âœ… Responsive Design (1679ms)
âœ… Accessibility Features (718ms)

=== UI Component Test Summary ===
Total Tests: 9
âœ… Passed: 9
âŒ Failed: 0
â±ï¸  Average Duration: 831.33ms

âœ… UI Component Tests PASSED


ğŸ COMPREHENSIVE FUNCTIONAL TEST SUITE RESULTS
==============================================

ğŸ“Š Overall Summary:
   Total Tests: NaN
   âœ… Passed: 48
   âŒ Failed: 2
   â­ï¸  Skipped: 0
   â±ï¸  Total Duration: 15.66s
   ğŸ“ˆ Avg Response Time: 5.65ms

ğŸ“¡ API Test Results:
   Tests: undefined
   Passed: 21
   Failed: 0
   Avg Response: 5.14ms

ğŸ§® Business Logic Test Results:
   Tests: 20
   Passed: 18
   Failed: 2

ğŸ–¥ï¸  UI Component Test Results:
   Tests: 9
   Passed: 9
   Failed: 0

ğŸ“ˆ Performance Insights:
   Total Requests: 40
   Fast Requests (<100ms): 40
   Slow Requests (>500ms): 0

âŒ Failed Tests Summary:
   Business Logic Failures:
     â€¢ Busy Day Scenario Validation: Scheduling conflict detected for staff 797081cf-c993-4df8-b155-03319682091b: Sun Sep 14 2025 11:30:00 GMT-0600 (Mountain Daylight Time) - Sun Sep 14 2025 12:45:00 GMT-0600 (Mountain Daylight Time) overlaps with Sun Sep 14 2025 10:30:00 GMT-0600 (Mountain Daylight Time) - Sun Sep 14 2025 11:45:00 GMT-0600 (Mountain Daylight Time)
     â€¢ Invalid Loyalty Entry Validation: Validation failures: Unexpected error: Error: POST /api/loyalty/entries -> 400; Unexpected error: Error: POST /api/loyalty/entries -> 400; Unexpected error: Error: POST /api/loyalty/entries -> 400

ğŸ¯ Final Verdict:
   âŒ FUNCTIONAL TESTS FAILED
   ğŸ”§ Platform requires fixes before deployment
   ğŸš¨ Major issues detected - significant work needed

==============================================

âŒ Some functional tests failed.
